{% extends 'base.html' %}

{% block body %}
<h1>Car Inventory</h1>

{% if session.get('user_id') %}
    <h2>Welcome {{ user[1] }}!</h2>
    <nav>
        <a href="{{ url_for('home') }}">Car Inventory</a>
        <a href="{{ url_for('Mygarage') }}">Go to My Garage</a>
        <a href="{{ url_for('logout') }}">Logout</a>
    </nav>
{% else %}
    <h2>Please log in to add cars</h2>
{% endif %}

{% if data %}
    {% for row in data %}
        <div class="car-card">
            {% if row[9] %}
                <img src="{{ url_for('static', filename='image/' ~ row[9]) }}" 
                     alt="{{ row[1] }} {{ row[6] }}" 
                     class="car-image"/>
            {% endif %}

            <h3>{{ row[1] }} {{ row[6] }}</h3>
            <p>Engine: {{ row[2] }}</p>
            <p>HP: {{ row[3] }}</p>
            <p>Torque: {{ row[4] }}</p>
            <p>Price: {{ row[5] }}</p>
            <p>Drive Train: {{ row[7] }}</p>
            <p>Car Type: {{ row[8] }}</p>

            {% if session.get('user_id') %}
                {% if in_garage %}
                    <!-- Remove button when viewing My Garage -->
                    <form action="{{ url_for('remove_from_garage') }}" method="POST">
                        <input type="hidden" name="car_id" value="{{ row[0] }}">
                        <button type="submit" class="btn">Remove from Garage</button>
                    </form>
                {% else %}
                    <!-- Add button when viewing main inventory -->
                    <form action="{{ url_for('add_to_garage') }}" method="POST">
                        <input type="hidden" name="car_id" value="{{ row[0] }}">
                        <button type="submit" class="btn">Add to Garage</button>
                    </form>
                {% endif %}
            {% endif %}
        </div>
    {% endfor %}
{% else %}
    <h3>No cars available.</h3>
{% endif %}

{% if not session.get('user_id') %}
    <h2>Please log in to add cars</h2>

    <form action="{{ url_for('login') }}" method="POST">
        <label for="username">Username:</label>
        <input type="text" name="username" required>
        <label for="password">Password:</label>
        <input type="password" name="password" required>
        <button type="submit">Log In</button>
    </form>

    <form action="{{ url_for('signup') }}" method="POST">
        <label for="username">Username:</label>
        <input type="text" name="username" required>
        <label for="password">Password:</label>
        <input type="password" name="password" required>
        <button type="submit">Sign Up</button>
    </form>

    <p>Already have an account? <a href="{{ url_for('login') }}">Log In</a></p>
{% endif %}
{% endblock %}
